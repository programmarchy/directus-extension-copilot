import{useApi as t,definePanel as e}from"@directus/extensions-sdk";import{defineComponent as n,ref as a,resolveComponent as o,openBlock as i,createElementBlock as s,normalizeClass as r,createElementVNode as l,createVNode as d,createBlock as c,withCtx as u,Fragment as p,renderList as m,toDisplayString as g}from"vue";const f="Sorry, I couldn't find an answer to that question. Could you try rephrasing it?";var y=n({props:{showHeader:{type:Boolean,default:!1},key:{type:String,default:""}},setup(e){const n=t(),o=a(""),i=a(!1),s=a([{type:"bot",text:"Ask me a question about your data, and I'll do my best to answer!",timestamp:Date.now()}]);function r(t){s.value.unshift(t)}return{questionInput:o,messages:s,loading:i,ask:async function(){const t=o.value;r({type:"human",text:t,timestamp:Date.now()}),i.value=!0,o.value="";try{const{data:a}=await n.post("copilot/ask",{question:t,key:e.key});if(r({type:"bot",text:(null==a?void 0:a.message)||f,timestamp:Date.now()}),null==a?void 0:a.api){const{path:o,method:i,args:s}=a.api;try{const{data:a}=await n.request({method:i,url:o,data:s}),{data:l}=await n.post("copilot/ask/callback",{key:e.key,question:t,output:JSON.stringify(a)});r({type:"bot",text:(null==l?void 0:l.message)||f,timestamp:Date.now()})}catch(a){const{data:o}=await n.post("copilot/ask/callback",{key:e.key,question:t});r({type:"bot",text:(null==o?void 0:o.message)||f,timestamp:Date.now()})}}}catch(t){console.error(t),r({type:"bot",text:`Something went wrong. Here's the error I got: ${v(t)}`,timestamp:Date.now()})}finally{i.value=!1}}}}});function v(t){var e,n;const a=null==(n=null==(e=null==t?void 0:t.response)?void 0:e.data)?void 0:n.errors;if(Array.isArray(a)&&a.length>0){const t=a[0].message;if(t)return String(t)}return(null==t?void 0:t.message)?String(t.message):"Unknown error"}var h=[],x=[];!function(t,e){if(t&&"undefined"!=typeof document){var n,a=!0===e.prepend?"prepend":"append",o=!0===e.singleTag,i="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(o){var s=h.indexOf(i);-1===s&&(s=h.push(i)-1,x[s]={}),n=x[s]&&x[s][a]?x[s][a]:x[s][a]=r()}else n=r();65279===t.charCodeAt(0)&&(t=t.substring(1)),n.styleSheet?n.styleSheet.cssText+=t:n.appendChild(document.createTextNode(t))}function r(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var n=Object.keys(e.attributes),o=0;o<n.length;o++)t.setAttribute(n[o],e.attributes[n[o]]);var s="prepend"===a?"afterbegin":"beforeend";return i.insertAdjacentElement(s,t),t}}("\n.copilot[data-v-e327c611] {\n\tdisplay: flex;\n\tflex-direction: column-reverse;\n\tgap: 12px;\n\tpadding: 12px;\n\theight: 100%;\n&.show-header[data-v-e327c611] {\n\t\tpadding-top: 6px;\n}\n.ask-question[data-v-e327c611] {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: 12px;\n.loading[data-v-e327c611] {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n}\n}\n.messages[data-v-e327c611] {\n\t\tflex-direction: column-reverse;\n\t\tdisplay: flex;\n\t\tflex: 1;\n\t\toverflow-y: auto;\n\t\tgap: 12px;\n.message[data-v-e327c611] {\n\t\t\tpadding: 8px;\n\t\t\tborder-radius: 8px;\n\t\t\tcolor: var(--text-normal);\n\t\t\tline-height: 1.5;\n\t\t\tmax-width: 90%;\n}\n.message[data-v-e327c611]:first-child {\n\t\t\tmax-width: 100%;\n}\n.human[data-v-e327c611] {\n\t\t\talign-self: end;\n\t\t\ttext-align: right;\n\t\t\tbackground-color: var(--primary);\n}\n.bot[data-v-e327c611] {\n\t\t\talign-self: start;\n\t\t\ttext-align: left;\n\t\t\tbackground-color: var(--background-normal);\n}\n}\n}\n",{});const k={class:"ask-question"},b={key:0,class:"loading"},w={class:"messages"};const q=[],A=[],_=[],I=[],S=[e({id:"copilot",name:"Copilot",icon:"robot",description:"Ask Copilot a question about your data.",component:((t,e)=>{const n=t.__vccOpts||t;for(const[t,a]of e)n[t]=a;return n})(y,[["render",function(t,e,n,a,f,y){const v=o("v-input"),h=o("v-progress-circular"),x=o("v-icon"),q=o("v-button");return i(),s("div",{class:r(["copilot",{"show-header":t.showHeader}])},[l("div",k,[d(v,{modelValue:t.questionInput,"onUpdate:modelValue":e[0]||(e[0]=e=>t.questionInput=e),placeholder:"Ask a question..."},null,8,["modelValue"]),t.loading?(i(),s("div",b,[d(h,{indeterminate:""})])):(i(),c(q,{key:1,icon:"",rounded:"",outlined:"","x-small":"",disabled:t.loading,onClick:t.ask},{default:u((()=>[d(x,{name:"arrow_upward"})])),_:1},8,["disabled","onClick"]))]),l("div",w,[(i(!0),s(p,null,m(t.messages,(t=>(i(),s("div",{class:r(["message",t.type])},g(t.text),3)))),256))])],2)}],["__scopeId","data-v-e327c611"],["__file","panel-copilot.vue"]]),options:[{field:"key",name:"OpenAI API Key",type:"string",meta:{interface:"input",width:"full",note:'Defaults to the `OPENAI_API_KEY` defined in your project\'s <a href="https://docs.directus.io/self-hosted/config-options.html" target="_blank" title="Configuration Options">configuration options</a>.',options:{iconRight:"vpn_key"}}}],minWidth:16,minHeight:24})],C=[];export{A as displays,q as interfaces,_ as layouts,I as modules,C as operations,S as panels};
