import{useApi as t,definePanel as e}from"@directus/extensions-sdk";import{defineComponent as n,ref as a,resolveComponent as o,openBlock as i,createElementBlock as s,normalizeClass as l,createElementVNode as r,createVNode as d,createBlock as p,withCtx as u,Fragment as c,renderList as m,toDisplayString as g}from"vue";const f="Sorry, I couldn't find an answer to that question. Could you try rephrasing it?";var y=n({props:{showHeader:{type:Boolean,default:!1},apiKey:{type:String,default:""},llm:{type:String,default:"gpt-3.5-turbo-0613"}},setup(e){const n=t(),o=a(""),i=a(!1),s=a([{type:"bot",text:"Ask me a question about your data, and I'll do my best to answer!",timestamp:Date.now()}]);function l(t){s.value.unshift(t)}return{questionInput:o,messages:s,loading:i,ask:async function(t){t.preventDefault();const a=o.value;l({type:"human",text:a,timestamp:Date.now()}),i.value=!0,o.value="";try{const{data:t}=await n.post("copilot/ask",{question:a,key:e.apiKey,llm:e.llm});if(l({type:"bot",text:(null==t?void 0:t.message)||f,timestamp:Date.now()}),null==t?void 0:t.api){const{path:o,method:i,args:s}=t.api;try{const{data:t}=await n.request({method:i,url:o,data:s}),{data:r}=await n.post("copilot/ask/callback",{question:a,key:e.apiKey,llm:e.llm,output:JSON.stringify(t)});l({type:"bot",text:(null==r?void 0:r.message)||f,timestamp:Date.now()})}catch(t){const{data:o}=await n.post("copilot/ask/callback",{question:a,key:e.apiKey,llm:e.llm});l({type:"bot",text:(null==o?void 0:o.message)||f,timestamp:Date.now()})}}}catch(t){console.error(t),l({type:"bot",text:`Something went wrong. Here's the error I got: ${v(t)}`,timestamp:Date.now()})}finally{i.value=!1}}}}});function v(t){var e,n;const a=null==(n=null==(e=null==t?void 0:t.response)?void 0:e.data)?void 0:n.errors;if(Array.isArray(a)&&a.length>0){const t=a[0].message;if(t)return String(t)}return(null==t?void 0:t.message)?String(t.message):"Unknown error"}var h=[],b=[];!function(t,e){if(t&&"undefined"!=typeof document){var n,a=!0===e.prepend?"prepend":"append",o=!0===e.singleTag,i="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(o){var s=h.indexOf(i);-1===s&&(s=h.push(i)-1,b[s]={}),n=b[s]&&b[s][a]?b[s][a]:b[s][a]=l()}else n=l();65279===t.charCodeAt(0)&&(t=t.substring(1)),n.styleSheet?n.styleSheet.cssText+=t:n.appendChild(document.createTextNode(t))}function l(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var n=Object.keys(e.attributes),o=0;o<n.length;o++)t.setAttribute(n[o],e.attributes[n[o]]);var s="prepend"===a?"afterbegin":"beforeend";return i.insertAdjacentElement(s,t),t}}("\n.copilot[data-v-87392c66] {\n\tdisplay: flex;\n\tflex-direction: column-reverse;\n\tgap: 12px;\n\tpadding: 12px;\n\theight: 100%;\n&.show-header[data-v-87392c66] {\n\t\tpadding-top: 6px;\n}\n.ask-question[data-v-87392c66] {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: 12px;\n.loading[data-v-87392c66] {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n}\n}\n.messages[data-v-87392c66] {\n\t\tflex-direction: column-reverse;\n\t\tdisplay: flex;\n\t\tflex: 1;\n\t\toverflow-y: auto;\n\t\tgap: 12px;\n.message[data-v-87392c66] {\n\t\t\tpadding: 8px;\n\t\t\tborder-radius: 8px;\n\t\t\tcolor: var(--text-normal);\n\t\t\tline-height: 1.5;\n\t\t\tmax-width: 90%;\n}\n.message[data-v-87392c66]:first-child {\n\t\t\tmax-width: 100%;\n}\n.human[data-v-87392c66] {\n\t\t\talign-self: end;\n\t\t\ttext-align: right;\n\t\t\tbackground-color: var(--primary);\n}\n.bot[data-v-87392c66] {\n\t\t\talign-self: start;\n\t\t\ttext-align: left;\n\t\t\tbackground-color: var(--background-normal);\n}\n}\n}\n",{});const x={key:0,class:"loading"},w={class:"messages"};const k=[],A=[],q=[],_=[],I=[e({id:"copilot",name:"Copilot",icon:"robot",description:"Ask Copilot a question about your data.",component:((t,e)=>{const n=t.__vccOpts||t;for(const[t,a]of e)n[t]=a;return n})(y,[["render",function(t,e,n,a,f,y){const v=o("v-input"),h=o("v-progress-circular"),b=o("v-icon"),k=o("v-button");return i(),s("div",{class:l(["copilot",{"show-header":t.showHeader}])},[r("form",{class:"ask-question",onSubmit:e[1]||(e[1]=(...e)=>t.ask&&t.ask(...e))},[d(v,{modelValue:t.questionInput,"onUpdate:modelValue":e[0]||(e[0]=e=>t.questionInput=e),placeholder:"Ask a question..."},null,8,["modelValue"]),t.loading?(i(),s("div",x,[d(h,{indeterminate:""})])):(i(),p(k,{key:1,icon:"",rounded:"",outlined:"","x-small":"",disabled:t.loading,type:"submit"},{default:u((()=>[d(b,{name:"arrow_upward"})])),_:1},8,["disabled"]))],32),r("div",w,[(i(!0),s(c,null,m(t.messages,(t=>(i(),s("div",{class:l(["message",t.type])},g(t.text),3)))),256))])],2)}],["__scopeId","data-v-87392c66"],["__file","panel-copilot.vue"]]),options:[{field:"apiKey",name:"OpenAI API Key",type:"string",meta:{interface:"input",width:"full",note:'Defaults to the `OPENAI_API_KEY` defined in your project\'s <a href="https://docs.directus.io/self-hosted/config-options.html" target="_blank" title="Configuration Options">configuration options</a>.',options:{iconRight:"vpn_key"}}},{field:"llm",name:"Model",type:"string",schema:{default_value:"gpt-3.5-turbo-0613"},meta:{interface:"select-dropdown",width:"full",note:'Defaults to `gpt-3.5-turbo-0613`. See <a href="https://platform.openai.com/docs/models" target="_blank" title="OpenAI Models">OpenAI Models</a> for more information.',options:{choices:[{text:"GPT-3.5",value:"gpt-3.5-turbo-0613"},{text:"GPT-4",value:"gpt-4"}],allowOther:!0}}}],minWidth:16,minHeight:24})],S=[];export{A as displays,k as interfaces,q as layouts,_ as modules,S as operations,I as panels};
