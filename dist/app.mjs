import{useApi as t,definePanel as e}from"@directus/extensions-sdk";import{defineComponent as n,ref as a,resolveComponent as o,openBlock as s,createElementBlock as i,normalizeClass as r,createElementVNode as l,createVNode as d,createBlock as u,withCtx as p,Fragment as c,renderList as m,toDisplayString as g}from"vue";const f="Sorry, I couldn't find an answer to that question. Could you try rephrasing it?";var y=n({props:{showHeader:{type:Boolean,default:!1},key:{type:String,default:""}},setup(e){const n=t(),o=a(""),s=a(!1),i=a([{type:"bot",text:"Ask me a question about your data, and I'll do my best to answer!",timestamp:Date.now()}]);function r(t){i.value.unshift(t)}return{questionInput:o,messages:i,loading:s,ask:async function(t){t.preventDefault();const a=o.value;r({type:"human",text:a,timestamp:Date.now()}),s.value=!0,o.value="";try{const{data:t}=await n.post("copilot/ask",{question:a,key:e.key});if(r({type:"bot",text:(null==t?void 0:t.message)||f,timestamp:Date.now()}),null==t?void 0:t.api){const{path:o,method:s,args:i}=t.api;try{const{data:t}=await n.request({method:s,url:o,data:i}),{data:l}=await n.post("copilot/ask/callback",{key:e.key,question:a,output:JSON.stringify(t)});r({type:"bot",text:(null==l?void 0:l.message)||f,timestamp:Date.now()})}catch(t){const{data:o}=await n.post("copilot/ask/callback",{key:e.key,question:a});r({type:"bot",text:(null==o?void 0:o.message)||f,timestamp:Date.now()})}}}catch(t){console.error(t),r({type:"bot",text:`Something went wrong. Here's the error I got: ${v(t)}`,timestamp:Date.now()})}finally{s.value=!1}}}}});function v(t){var e,n;const a=null==(n=null==(e=null==t?void 0:t.response)?void 0:e.data)?void 0:n.errors;if(Array.isArray(a)&&a.length>0){const t=a[0].message;if(t)return String(t)}return(null==t?void 0:t.message)?String(t.message):"Unknown error"}var h=[],x=[];!function(t,e){if(t&&"undefined"!=typeof document){var n,a=!0===e.prepend?"prepend":"append",o=!0===e.singleTag,s="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(o){var i=h.indexOf(s);-1===i&&(i=h.push(s)-1,x[i]={}),n=x[i]&&x[i][a]?x[i][a]:x[i][a]=r()}else n=r();65279===t.charCodeAt(0)&&(t=t.substring(1)),n.styleSheet?n.styleSheet.cssText+=t:n.appendChild(document.createTextNode(t))}function r(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var n=Object.keys(e.attributes),o=0;o<n.length;o++)t.setAttribute(n[o],e.attributes[n[o]]);var i="prepend"===a?"afterbegin":"beforeend";return s.insertAdjacentElement(i,t),t}}("\n.copilot[data-v-10771e79] {\n\tdisplay: flex;\n\tflex-direction: column-reverse;\n\tgap: 12px;\n\tpadding: 12px;\n\theight: 100%;\n&.show-header[data-v-10771e79] {\n\t\tpadding-top: 6px;\n}\n.ask-question[data-v-10771e79] {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: 12px;\n.loading[data-v-10771e79] {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n}\n}\n.messages[data-v-10771e79] {\n\t\tflex-direction: column-reverse;\n\t\tdisplay: flex;\n\t\tflex: 1;\n\t\toverflow-y: auto;\n\t\tgap: 12px;\n.message[data-v-10771e79] {\n\t\t\tpadding: 8px;\n\t\t\tborder-radius: 8px;\n\t\t\tcolor: var(--text-normal);\n\t\t\tline-height: 1.5;\n\t\t\tmax-width: 90%;\n}\n.message[data-v-10771e79]:first-child {\n\t\t\tmax-width: 100%;\n}\n.human[data-v-10771e79] {\n\t\t\talign-self: end;\n\t\t\ttext-align: right;\n\t\t\tbackground-color: var(--primary);\n}\n.bot[data-v-10771e79] {\n\t\t\talign-self: start;\n\t\t\ttext-align: left;\n\t\t\tbackground-color: var(--background-normal);\n}\n}\n}\n",{});const b={key:0,class:"loading"},k={class:"messages"};const w=[],q=[],A=[],_=[],I=[e({id:"copilot",name:"Copilot",icon:"robot",description:"Ask Copilot a question about your data.",component:((t,e)=>{const n=t.__vccOpts||t;for(const[t,a]of e)n[t]=a;return n})(y,[["render",function(t,e,n,a,f,y){const v=o("v-input"),h=o("v-progress-circular"),x=o("v-icon"),w=o("v-button");return s(),i("div",{class:r(["copilot",{"show-header":t.showHeader}])},[l("form",{class:"ask-question",onSubmit:e[1]||(e[1]=(...e)=>t.ask&&t.ask(...e))},[d(v,{modelValue:t.questionInput,"onUpdate:modelValue":e[0]||(e[0]=e=>t.questionInput=e),placeholder:"Ask a question..."},null,8,["modelValue"]),t.loading?(s(),i("div",b,[d(h,{indeterminate:""})])):(s(),u(w,{key:1,icon:"",rounded:"",outlined:"","x-small":"",disabled:t.loading,type:"submit"},{default:p((()=>[d(x,{name:"arrow_upward"})])),_:1},8,["disabled"]))],32),l("div",k,[(s(!0),i(c,null,m(t.messages,(t=>(s(),i("div",{class:r(["message",t.type])},g(t.text),3)))),256))])],2)}],["__scopeId","data-v-10771e79"],["__file","panel-copilot.vue"]]),options:[{field:"key",name:"OpenAI API Key",type:"string",meta:{interface:"input",width:"full",note:'Defaults to the `OPENAI_API_KEY` defined in your project\'s <a href="https://docs.directus.io/self-hosted/config-options.html" target="_blank" title="Configuration Options">configuration options</a>.',options:{iconRight:"vpn_key"}}}],minWidth:16,minHeight:24})],S=[];export{q as displays,w as interfaces,A as layouts,_ as modules,S as operations,I as panels};
